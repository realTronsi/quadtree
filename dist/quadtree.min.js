!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Quadtree=e():t.Quadtree=e()}(this,(()=>(()=>{"use strict";var t={d:(e,h)=>{for(var i in h)t.o(h,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:h[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{Quadtree:()=>h});class h{constructor(t,e,h,i,s,n,r){this.x1=t,this.y1=e,this.x2=h,this.y2=i,this.mx=t+(h-t)/2,this.my=e+(i-e)/2,this.maxChildren=s,this.depth=n,this.parent=r,this.children=[],this.nodes=[]}getBoundQuadrant(t){if(0===this.nodes.length)return-1;if(t.y2<this.my&&t.y1>this.y1){if(t.x2<this.mx&&t.x1>this.x1)return 0;if(t.x1>this.mx&&t.x2<this.x2)return 1}if(t.y1>this.my&&t.y2<this.y2){if(t.x2<this.mx&&t.x1>this.x1)return 2;if(t.x1>this.mx&&t.x2<this.x2)return 3}return-1}push(t){const e=this.getBoundQuadrant(t.bound);if(-1!==e)return this.nodes[e].push(t);if(this.children.push(t),t._qtree_node=this,0!==this.nodes.length||0===this.depth||this.children.length<=this.maxChildren)return;this.nodes=[new h(this.x1,this.y1,this.mx,this.my,this.maxChildren,this.depth-1,this),new h(this.mx,this.y1,this.x2,this.my,this.maxChildren,this.depth-1,this),new h(this.x1,this.my,this.mx,this.y2,this.maxChildren,this.depth-1,this),new h(this.mx,this.my,this.x2,this.y2,this.maxChildren,this.depth-1,this)];const i=this.children;let s=i.length,n=s;for(;--s;){const t=i[s],e=this.getBoundQuadrant(t.bound);if(-1!==e){this.nodes[e].push(t),n--;let h=s;for(;h<n;)i[h]=i[++h];i.pop()}}}remove(t){const e=t._qtree_node.children,h=e.indexOf(t);e[h]=e[e.length-1],e.pop(),0===this.nodes.length&&this.parent.clean()}clean(){const t=this.nodes;t[0].children.length>0||t[1].children.length>0||t[2].children.length>0||t[3].children.length>0||(this.nodes=[],this.parent.clean())}removePreserve(t){const e=t._qtree_node.children;let h=e.indexOf(t);if(e[h]=e[e.length-1],e.pop(),0!==this.nodes.length)return;const i=this.nodes;if(i[0].children.length+i[1].children.length+i[2].children.length+i[3].children.length<=this.maxChildren)return;const s=i[0].children;for(h=s.length;--h;)this.children.push(s[h]);const n=i[1].children;for(h=n.length;--h;)this.children.push(n[h]);const r=i[2].children;for(h=r.length;--h;)this.children.push(r[h]);const d=i[3].children;for(h=d.length;--h;)this.children.push(d[h]);this.nodes=[]}query(t,e,h,i,s){if(function(t,e,h,i,s,n,r,d){return r<t||s>h||d<e||n>i}(this.x1,this.y1,this.x2,this.y2,t,e,h,i))return;const n=this.children,r=this.nodes;let d=n.length;for(;d--;)if(s(n[d]))return;0!==r.length&&(r[0].query(t,e,h,i,s),r[1].query(t,e,h,i,s),r[2].query(t,e,h,i,s),r[3].query(t,e,h,i,s))}clear(){this.children=[],this.nodes=[]}}return e.Quadtree})()));